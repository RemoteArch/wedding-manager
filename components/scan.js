const{useEffect:e,useRef:t,useState:a}=React,{detectQr:n,ensureJsQr:r}=await loadModule("./modules/jjsqr.js"),c=()=>React.createElement("section",{className:"relative w-full md:w-1/2 h-screen flex flex-col  items-center justify-center"},React.createElement("img",{src:"./assets/images/scan/top-left-1.png",alt:"",className:"absolute left-0 top-0 w-[200px] max-w-none pointer-events-none select-none z-10","aria-hidden":"true"}),React.createElement("img",{src:"./assets/images/scan/top-left-2.png",alt:"",className:"absolute left-0 top-0 w-[300px] max-w-none pointer-events-none select-none z-10","aria-hidden":"true"}),React.createElement("img",{src:"./assets/images/scan/top-right-1.png",alt:"",className:"absolute right-0 top-0 w-[220px] max-w-none pointer-events-none select-none z-10","aria-hidden":"true"}),React.createElement("img",{src:"./assets/images/scan/bottom-left-1.png",alt:"",className:"absolute left-0 bottom-0 w-[260px] max-w-none pointer-events-none select-none z-10","aria-hidden":"true"}),React.createElement("div",{className:"w-full h-auto text-center relative z-20 mb-4"},React.createElement("p",{className:"playfair-display text-[28px] text-gray-700 italic"},"Bienvenue au mariage de"),React.createElement("p",{className:"playfair-display text-[42px] text-[#8B4513] font-bold"},"Kristel & Frank")),React.createElement("img",{src:"./assets/images/scan/wedding-welcome.png",alt:"Bienvenue au mariage",className:"w-full h-auto object-contain relative z-0"}),React.createElement("div",{className:"absolute w-full h-[741px] -bottom-[500px] bg-white blur-[75px] pointer-events-none z-0"}));((e,t="Kristel & Frank - Mariage")=>{const a=document.querySelector("link[rel*='icon']")||document.createElement("link");a.type="image/png",a.rel="icon",a.href=e,document.getElementsByTagName("head")[0].appendChild(a),document.title=t})("./assets/images/initial.png");const s=e=>{const t=String(e||""),a=t.match(/TABLE\s*N[°º]?\s*\d+/i);return a?a[0].toUpperCase().replace("TABLE",""):t},l=()=>{const n=t([]),[r,c]=a(null),[l,o]=a(!1),m=()=>{(async()=>{try{const e=await fetch("/api/index.php/index/invitations"),t=await e.json();return t.success&&Array.isArray(t.data)?t.data.map((e=>({nom:e.invite,table:s(e.table),code:e.invite_code,status:e.status}))):[]}catch(e){return console.error("Erreur lors de la récupération des invités:",e),[]}})().then((e=>{n.current=e}))};e((()=>{m()}),[]);return React.createElement("section",{className:"w-full md:w-1/2 min-h-screen"},React.createElement("div",{className:"w-full min-h-screen bg-[#7A3B24] px-6 py-10 relative overflow-hidden"},React.createElement("img",{src:"./assets/images/scan/left-top.png",alt:"",className:"absolute left-0 top-0 w-[220px] max-w-none pointer-events-none select-none","aria-hidden":"true"}),React.createElement("img",{src:"./assets/images/scan/left-bottom.png",alt:"",className:"absolute left-0 bottom-0 w-[260px] max-w-none pointer-events-none select-none","aria-hidden":"true"}),React.createElement("div",{className:"w-full max-w-[520px] mx-auto relative z-10 min-h-[calc(100vh-5rem)] flex flex-col justify-between"},React.createElement("div",{className:"flex flex-row items-center justify-center gap-4"},React.createElement("div",{className:""},React.createElement("img",{src:"./assets/images/scan/qr.png",alt:"QR",className:"w-20 h-20 object-contain"})),React.createElement("div",{className:"text-white text-center"},React.createElement("p",{className:"text-[22px] font-semibold leading-tight playfair-display"},"Instants du mariage"),React.createElement("p",{className:"text-[16px] whitespace-pre-line opacity-95 leading-snug mt-1 eb-garamond"},"Scannez pour découvrir tous les\ninstants capturés de l'évènement"))),React.createElement("div",{className:"bg-black rounded-[22px] px-6 pt-10 pb-8 shadow-2xl flex flex-col"},React.createElement("p",{className:"text-white text-center text-[30px] font-semibold leading-tight"},"Scannez votre QR Code ici"),React.createElement("div",{className:"flex-1 flex items-center justify-center"},r?React.createElement("div",{className:"bg-white rounded-[22px] px-8 py-12 shadow-2xl text-center max-w-md w-full"},React.createElement("p",{className:"text-[32px] font-bold mb-8 playfair-display italic underline"},"scanned"===r.status?"DÉJÀ SCANNÉ":"ACCÈS AUTORISÉ !!"),React.createElement("p",{className:"text-[#8B0000] text-[36px] font-semibold mb-6 playfair-display"},r.nom),React.createElement("p",{className:"text-[#B8A07A] text-[24px] font-semibold playfair-display uppercase"},"TABLE ",r.table),"scanned"===r.status&&React.createElement("p",{className:"text-[#FF6B6B] text-[18px] font-semibold mt-6 eb-garamond"},"Cet invité a déjà été scanné")):l?React.createElement("div",{className:"bg-white rounded-[22px] px-8 py-12 shadow-2xl text-center max-w-md w-full"},React.createElement("p",{className:"text-[#8B0000] text-[32px] font-bold playfair-display italic underline"},"ACCÈS NON AUTORISÉ")):React.createElement(i,{onQrDetected:async e=>{const t=n.current.find((t=>t.code==e));if(t){if(c(t),o(!1),"scanned"!==t.status){try{await fetch("/api/index.php/index/invitation_status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,status:"scanned"})})}catch(e){console.error("Error updating invitation status:",e)}m()}setTimeout((()=>{c(null)}),5e3)}else o(!0),c(null),setTimeout((()=>{o(!1)}),5e3)}}))),React.createElement("div",{className:"flex flex-row items-center justify-center gap-5 text-white"},React.createElement("div",{className:""},React.createElement("img",{src:"./assets/images/scan/scan-advice.png",alt:"Conseil",className:"w-[80px] h-[80px] object-contain"})),React.createElement("div",null,React.createElement("p",{className:"text-[22px] font-semibold leading-tight playfair-display"},"Conseil"),React.createElement("p",{className:"text-[16px] whitespace-pre-line opacity-95 leading-snug mt-1 eb-garamond"},"Présentez votre QR Code sur\nla camera de l'écran pour le\nvérifier."))))))},i=({onQrDetected:c})=>{const s=t(null),l=t(null),i=t(0),o=t(null),m=t(0),d=t(null),[u,p]=a(null),[f,g]=a(null),[x,h]=a(!1);return e((()=>{let e=!1;const t=()=>{try{i.current&&cancelAnimationFrame(i.current)}catch{}i.current=0;const e=o.current;if(o.current=null,e)try{for(const t of e.getTracks())t.stop()}catch{}};return(async()=>{try{g(null),h(!1),await r();const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});if(e){try{for(const e of t.getTracks())e.stop()}catch{}return}o.current=t;const a=s.current;if(!a)return;try{a.setAttribute("playsinline","true")}catch{}try{a.setAttribute("webkit-playsinline","true")}catch{}const u=()=>{e||h(!0)};try{a.addEventListener("playing",u,{once:!0})}catch{}try{a.addEventListener("loadeddata",u,{once:!0})}catch{}try{a.addEventListener("canplay",u,{once:!0})}catch{}a.srcObject=t,await new Promise((e=>{if(a.readyState>=1)return e();a.addEventListener("loadedmetadata",(()=>e()),{once:!0})}));try{await a.play(),a.videoWidth>0&&a.videoHeight>0&&u()}catch(e){throw h(!1),new Error("Lecture vidéo bloquée. Autorise la caméra et vérifie que la page est en HTTPS (ou localhost).")}const p=async()=>{if(e)return;const t=performance.now();if(t-m.current<250)return void(i.current=requestAnimationFrame(p));m.current=t;const r=l.current;if(!r||!a.videoWidth||!a.videoHeight)return!x&&a.videoWidth>0&&a.videoHeight>0&&h(!0),void(i.current=requestAnimationFrame(p));const s=r.getContext("2d",{willReadFrequently:!0});if(!s)return void(i.current=requestAnimationFrame(p));r.width!==a.videoWidth&&(r.width=a.videoWidth),r.height!==a.videoHeight&&(r.height=a.videoHeight),s.drawImage(a,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);x||h(!0);try{const e=await n(o);if(e?.data){const t=(e=>{if("string"!=typeof e)return e;try{return decodeURIComponent(e)}catch{return e}})(e.data);d.current!==t&&(d.current=t,"function"==typeof c&&c(t))}}catch{}i.current=requestAnimationFrame(p)};i.current=requestAnimationFrame(p)}catch(a){if(e)return;let n="Une erreur est survenue lors de l'accès à la caméra.";"NotAllowedError"===a?.name||"PermissionDeniedError"===a?.name?n="Accès à la caméra refusé. Veuillez autoriser la caméra dans votre navigateur.":"NotFoundError"===a?.name?n="Aucune caméra détectée sur cet appareil.":a?.message&&(n=a.message),g(n),t()}})(),()=>{e=!0,t()}}),[]),React.createElement("div",{className:"mt-8 w-full aspect-square bg-[#6b6b6b] rounded-[14px] border border-white/70 overflow-hidden relative"},React.createElement("video",{ref:s,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0}),React.createElement("canvas",{ref:l,className:"hidden"}),!x&&!f&&React.createElement("div",{className:"absolute inset-0 flex items-center justify-center text-white/90 text-[14px] px-6 text-center"},"Autorise l’accès à la caméra pour afficher le flux."),!!u&&React.createElement("div",{className:"absolute left-3 right-3 bottom-3 bg-black/70 text-white text-[14px] rounded px-3 py-2 break-words","aria-live":"polite"},u),!!f&&React.createElement("div",{className:"absolute left-3 right-3 bottom-3 bg-red-600/80 text-white text-[14px] rounded px-3 py-2"},f))};export default()=>React.createElement(React.Fragment,null,React.createElement("style",null,'\n                @import url(\'https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Dancing+Script:wght@400..700&display=swap\');\n                \n                .playfair-display {\n                    font-family: "Playfair Display", serif;\n                    font-optical-sizing: auto;\n                    font-style: normal;\n                }\n                \n                .eb-garamond {\n                    font-family: "EB Garamond", serif;\n                    font-optical-sizing: auto;\n                    font-style: normal;\n                }\n                \n                .dancing-script {\n                    font-family: "Dancing Script", cursive;\n                    font-optical-sizing: auto;\n                    font-style: normal;\n                }\n            '),React.createElement("div",{className:"w-full h-screen bg-white overflow-hidden"},React.createElement("div",{className:"w-full h-full flex flex-col md:flex-row"},React.createElement(l,null),React.createElement(c,null))));